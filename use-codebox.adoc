---
sidebar: sidebar 
permalink: use-codebox.html 
keywords: codebox, automation, cloudformation, rest api, aws cli, permissions 
summary: 您可以使用 Codebox 產生執行NetApp Workload Factory 支援的任何操作所需的程式碼。 
---
= 使用 Codebox 實現NetApp Workload Factory 中的自動化
:allow-uri-read: 
:icons: font
:imagesdir: ./media/


[role="lead"]
您可以使用 Codebox 產生執行NetApp Workload Factory 支援的任何操作所需的程式碼。您可以產生可使用 Workload Factory REST API、AWS CLI 和 AWS CloudFormation 使用和執行的程式碼。

Codebox 與 Workload Factory 權限策略保持一致，根據 Workload Factory 帳戶中為每個使用者提供的 AWS 權限，在程式碼中填入相應的資料。該程式碼可以像模板一樣使用，您可以在運行程式碼之前填寫缺少的資訊（例如，憑證）或自訂某些資料。



== 如何使用 CodeBox

當您在 Workload Factory UI 精靈中輸入值時，您可以在完成每個欄位時看到 Codebox 中的資料更新。完成精靈後，在選擇頁面底部的「建立」按鈕之前，請選擇image:button-copy-codebox.png["複製按鈕"]在 Codebox 中複製以擷取建置配置所需的程式碼。例如，此建立新 Microsoft SQL Server 的螢幕截圖顯示了 VPC 和可用區域的精靈項目以及 Codebox 中用於 REST API 實作的等效項目。

image:screenshot-codebox-example1.png["顯示如何在 UI 中建立 Microsoft SQL Server 的螢幕擷取畫面、以及 Codebox 中 VPC 和可用性區域的對應項目。"]

對於某些程式碼格式，您也可以選擇下載按鈕將程式碼儲存在可以帶到另一個系統的檔案中。如果需要，您可以在下載程式碼後編輯它，以便使其適應其他 AWS 帳戶。



== 使用 Codebox 的 CloudForgation 程式碼

您可以複製從 Codebox 產生的 CloudFormation 程式碼，然後在您的 AWS 帳戶中啟動 Amazon Web Services CloudFormation 堆疊。  CloudFormation 將執行您在 Workload Factory UI 中定義的操作。

使用 CloudFormation 程式碼的步驟可能會有所不同，具體取決於您是部署 FSx for ONTAP檔案系統、建立帳戶憑證還是執行其他 Workload Factory 操作。

請注意、 CloudForge-generated YAML 檔案中的程式碼會因安全理由在 7 天後過期。

.開始之前
* 您必須擁有認證才能登入 AWS 帳戶。
* 您必須擁有下列使用者權限、才能使用 CloudForgation 堆疊：
+
[%collapsible]
====
[source, json]
----
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "cloudformation:CreateStack",
                "cloudformation:UpdateStack",
                "cloudformation:DeleteStack",
                "cloudformation:DescribeStacks",
                "cloudformation:DescribeStackEvents",
                "cloudformation:DescribeChangeSet",
                "cloudformation:ExecuteChangeSet",
                "cloudformation:ListStacks",
                "cloudformation:ListStackResources",
                "cloudformation:GetTemplate",
                "cloudformation:ValidateTemplate",
                "lambda:InvokeFunction",
                "iam:PassRole",
                "iam:CreateRole",
                "iam:UpdateAssumeRolePolicy",
                "iam:AttachRolePolicy",
                "iam:CreateServiceLinkedRole"
            ],
            "Resource": "*"
        }
    ]
}
----
====


.步驟
. 使用 Workload Factory 控制台定義要執行的操作後，複製 Codebox 中的程式碼。
. 選取 * 重新導向至 CloudForgied* 、隨即顯示重新導向至 CloudForgation 頁面。
. 開啟另一個瀏覽器視窗、然後登入 AWS 管理主控台。
. 從「重新導向至 CloudForgation 」頁面選取 * 繼續 * 。
. 登入執行程式碼的 AWS 帳戶。
. 在「快速建立堆疊」頁面的「功能」下、選取 * 我瞭解 AWS CloudForemation 可能 ... * 。
. 選取 * 建立堆疊 * 。
. 從 AWS 或 Workload Factory 監控進度。




== 使用 CodeBox 的 REST API 程式碼

您可以使用 Codebox 產生的 Workload Factory REST API 來部署和管理 FSx for ONTAP檔案系統和其他 AWS 資源。

您可以從任何支援 Curl 且具備網際網路連線能力的主機執行 API 。

請注意、驗證權杖會隱藏在 Codebox 中、但會在您複製和貼上 API 呼叫時填入這些權杖。

.步驟
. 使用 Workload Factory 控制台定義要執行的操作後，複製 Codebox 中的 API 程式碼。
. 貼上程式碼、然後在主機系統上執行。




== 使用 CodeBox 的 AWS CLI 代碼

您可以使用從 Codebox 產生的 Amazon Web Services CLI 來部署和管理適用於 ONTAP 檔案系統和其他 AWS 資源的 FSX 。

.步驟
. 使用 Workload Factory 控制台定義要執行的操作後，將 AWS CLI 複製到 Codebox 中。
. 開啟另一個瀏覽器視窗、然後登入 AWS 管理主控台。
. 貼上程式碼並執行。




== 使用 CodeBox 的 Terraform

您可以使用 Terraform 來部署和管理適用於 ONTAP 檔案系統和其他 AWS 資源的 FSX 。

.開始之前
* 您需要安裝 Terraform 的系統（ Windows/Mac/Linux ）。
* 您必須擁有認證才能登入 AWS 帳戶。


.步驟
. 使用 Workload Factory 控制台定義要執行的操作後，從 Codebox 下載 Terraform 程式碼。
. 將下載的指令碼歸檔複製到安裝 Terraform 的系統。
. 解壓縮 zip 檔案、然後依照 README.MD 檔案中的步驟進行。

